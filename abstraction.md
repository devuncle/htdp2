# 抽象

我们的许多数据定义和函数定义看起来都相似。例如，字符串列表的定义与数字列表的定义仅在两个地方不同：数据类的名称以及单词“ String”和“ Number”。类似地，查找特定内容的函数字符串列表中的字符串与在数字列表中寻找特定数字的字符串几乎没有区别。

经验表明，这些相似性是有问题的。之所以产生相似性，是因为程序员在物理上或心理上都在复制代码。当程序员遇到与另一个大致相似的问题时，他们将复制解决方案并修改新副本以解决新问题。在“真实”编程环境以及电子表格和数学建模领域中，您都会发现这种行为。但是，复制代码意味着程序员复制错误，并且可能必须对许多副本应用相同的修复程序。这也意味着在修改或扩展基础数据定义时，必须以相应的方式找到并修改所有代码副本。这个过程既昂贵又容易出错，给编程团队增加了不必要的成本。

优秀的程序员会尽力消除编程语言所允许的相似之处。程序就像一篇论文。 第一个版本是草稿，草稿需要编辑。 “消除”意味着程序员写下他们的程序初稿，找出相似之处（和其他问题），并消除它们。 对于最后一步，它们要么抽象，要么使用现有（抽象）函数。 为了使程序达到令人满意的形状，通常需要多次迭代。

本部分的前半部分显示如何抽象函数和数据定义的相似性。 程序员还将该过程的结果称为抽象，将过程的名称及其结果混为一谈。 下半部分是关于使用现有抽象和新语言元素来促进此过程的。 尽管本部分中的示例取自列表领域，但是这些思想是普遍适用的。

## 14 相似性

如果您解决了“任意大数据”中的（部分）练习，就会知道许多解决方案看起来都是相似的。 实际上，相似之处可能会诱使您复制一个问题的解决方案以创建下一个问题的解决方案。 但是您不得窃取代码，甚至不能窃取您的密码。 相反，您必须对相似的代码段进行抽象，并且本章将教您如何抽象。

我们避免相似之处的方法专门针对“中级学生语言”或ISL。在DrRacket中，从“语言”菜单的“如何设计程序”子菜单中选择“中级学生”。 几乎所有其他编程语言都提供类似的方法。 在面向对象的语言中，您可能会发现其他抽象机制。 无论如何，这些机制都具有本章阐述的基本特征，因此，此处说明的设计思想也适用于其他情况。

### 14.1 函数中的相似性

### 14.2  不同的相似性

对于contains-dog，抽象看起来很容易吗？ 并包含猫？ 职能。 它仅需要比较两个函数定义，即使用函数参数替换文字字符串，并快速检查是否可以轻松地使用抽象函数定义旧函数。 这种抽象是如此自然，以至于在本书的前两部分都没有过多费力地出现。

本节说明相同的原理如何产生强大的抽象形式。 看一下图88。这两个函数都使用一个数字列表和一个阈值。 左边的一个将列出所有低于阈值的数字，而右边的一个将列出所有高于阈值的数字。

停止！ 此时，您应该问这个定义是否有意义。 不用大惊小怪，我们创建了一个使用函数的函数-您以前可能从未见过。如果您进行了微积分课程，您会遇到微分算子和不定积分。 这两个都是消耗和产生功能的功能。 但是，我们不假定您参加了微积分课程。 但是，事实证明，您的简单教学语言ISL支持此类功能，并且定义此类功能是优秀程序员的最强大工具之一--即使在似乎无法使用消耗函数的语言中也是如此 。

### 14.3 Similarities in Data Definitions

当然，问题是这些参数的范围是多少。 对于一个函数，它们代表一个未知值； 当应用该功能时，该值变为已知。 对于参数数据定义，参数代表整个值类别。 将数据集合的名称提供给参数数据定义的过程称为实例化。 以下是抽象列表的一些示例实例：
按照惯例，数据定义的参数使用带有所有大写字母的名称，而参数则根据需要拼写。
验证这些简写的真正含义的方法是用数据定义的实际项目名称（例如Number）替换数据定义的参数ITEM，并使用纯名称作为数据定义 ：

### 14.4 Functions Are Values

对语法的更改似乎要求对评估规则进行更改，但是所有更改都是值的集合。 具体而言，为了将函数用作函数的参数，最简单的更改是说函数和原始操作是值。

### 14.5 Computing with Functions

从BSL +到ISL的切换允许在应用程序的第一位置使用函数作为参数，以及使用名称。 DrRacket像在其他任何地方一样处理这些位置中的名称，但是自然地，它期望得到一个函数。 出乎意料的是，对代数定律的简单修改就足以评估ISL中的程序。

## 15 抽象设计

从本质上讲，抽象就是将具体内容变成参数。 在上一节中，我们有几次了。 要抽象类似的函数定义，您可以添加参数来替换定义中的具体值。 要抽象类似的数据定义，请创建参数数据定义。 当您遇到其他编程语言时，您会看到它们的抽象机制也需要引入参数，尽管它们可能不是函数参数。

### 15.1实例的抽象

当您第一次学习添加时，您就使用了具体示例。 您的父母可能教您用手指加两个小数。 后来，您研究了如何将两个任意数字相加； 向您介绍了您的第一种抽象。 到了很久以后，您还学会了公式化表达式，将温度从摄氏温度转换为华氏温度，或者计算汽车在给定速度和时间范围内的行驶距离。 简而言之，您从非常具体的示例转到了抽象关系。

本节介绍了从示例创建抽象的设计方法。 如上一节所示，创建抽象很容易。 我们将困难的部分留给下一部分，在此向您展示如何查找和使用现有的抽象。


## 16 使用抽象

一旦有了抽象，就应该尽可能使用它们。 它们创建了单点控制，并且是一种省力的设备。 更准确地说，使用抽象可以帮助您的代码读者理解您的意图。 如果抽象是众所周知的，并且已内置在该语言中或随其标准库一起提供，则与自定义设计的代码相比，它可以更清楚地表明函数的功能。

本章都是关于现有ISL抽象的重用。 它从有关现有ISL抽象的部分开始，其中一些是用假名称看到的。 其余部分是关于重用此类抽象的。 一个关键要素是局部的新语法构造，用于在函数内部局部定义函数和变量（甚至结构类型）。 在上一节中介绍的辅助成分是用于创建无名函数的lambda构造。 lambda是方便的，但对于重用抽象函数的想法而言并不重要。

### 16.1 Existing Abstractions

### 16.2 Local Definitions

让我们再看一下图97。带空格的字符串附加函数显然起从属的作用，在狭窄的上下文之外没有用。 此外，职能机构的组织没有反映出上述三个任务。

几乎所有的编程语言都支持某种方式来说明这类关系作为程序的一部分。 这个想法称为本地定义，也称为私有定义。 在ISL中，局部表达式引入了局部定义的函数，变量和结构类型。

视觉上最吸引人的差异关系到整个组织。 它清楚地表明该功能可以按顺序完成三个任务。 实际上，此示例演示了可读性的一般原则：
使用local重新编写深层嵌套的表达式。 使用精心选择的名称来表达表达式所计算的内容。

将来的读者会喜欢它，因为他们可以通过仅查看局部表达式的名称和主体来理解代码。

图99给出了第二个示例。 该函数定义的组织会通知读者sort-cmp调用了两个辅助函数：isort和insert。 就局部而言，很明显的是，插入目的陈述中的形容词“已排序”是指isort。 换句话说，insert仅在这种情况下有用。 程序员不应在上下文之外尝试在其他地方使用它。 尽管此约束在sort-cmp函数的原始定义中已经很重要，但是本地表达式将其表示为程序的一部分。

重组sort-cmp定义的另一个重要方面涉及第二个功能参数cmp的可见性。 本地定义的函数可以引用cmp，因为它是在定义的上下文中定义的。 通过不将cmp从isort传递到插入（或返回），读者可以立即推断出cmp在整个排序过程中保持不变。

### 16.3 本地定义增加了表达能力

第三个也是最后一个示例说明了local如何增加BSL和BSL +的表达能力。 有限状态机提出了一个世界程序的设计，该程序可以模拟有限状态机如何识别击键序列。 尽管数据分析自然地导致了图82中的数据定义，但是设计世界程序的主要功能的尝试失败了。 具体地说，即使给定的有限状态机在模拟过程中保持不变，世界的状态也必须包括它，以便在玩家按下按键时程序可以从一种状态转换到另一种状态。

## 17 无名函数

这种情况要求对语言进行改进。 程序员应该能够毫不费力地创建如此小的和微不足道的功能。如果您还没有这样做，请从DrRacket的“语言”菜单的“如何设计程序”子菜单中选择“带有lambda的中级学生”。 lambda的历史与编程和编程语言设计的早期历史密切相关。 我们的教学语言层次中的下一个层次是“带有lambda的中级学生语言”，它通过一个新概念即无名功能解决了这一问题。 本章介绍了该概念：其语法，含义和实用性。 从lambda的角度来看，上述定义从概念上讲是一种形式：

### 17.1 Functions from lambda

The syntax of lambda is straightforward:

(lambda (variable-1 ... variable-N) expression)

Its distinguishing characteristic is the keyword lambda. The keyword is followed by a sequence of variables, enclosed in a pair of parentheses. The last piece is an arbitrary expression, and it computes the result of the function when it is given values for its parameters.

### 17.2 Computing with lambda

lambda缩写某种本地变量的见解也将常量定义和函数定义联系起来。 除了查看给定的函数定义外，我们还可以将lambdas作为另一个基本概念，并说一个函数定义缩写了一个普通的常量定义，在右边带有lambda表达式。

## 18 总结

本书的第三部分是关于抽象在程序设计中的作用。抽象有两个方面：创建和使用。因此，自然而然地将本章总结为两课：

重复的代码模式要求抽象。抽象意味着将重复的代码片段（抽象）排除在外，并对差异进行参数化。通过设计适当的抽象，程序员可以避免将来的工作和麻烦，因为错误，效率低下和其他问题都集中在一处。因此，对抽象的一种解决方法可以一劳永逸地消除任何特定问题。相反，代码重复意味着程序员必须找到所有副本并在发现问题时修复所有副本。

大多数语言都带有大量抽象。一些是语言设计团队的贡献；其他语言则由使用该语言的程序员添加。为了能够有效地重用这些抽象，其创建者必须提供适当的文档（目的声明，签名和良好的示例），并且程序员使用它们来应用抽象。

所有编程语言都带有构建抽象的方法，尽管某些方法比其他方法更好。所有程序员都必须了解抽象的方法以及语言提供的抽象。独具慧眼的程序员将学习沿这些轴区分编程语言。
除了抽象之外，第三部分还介绍了

**函数是值，它们可以表示信息。**

尽管这个想法对于Lisp编程语言家族（例如ISL +）和编程语言研究专家而言是古老的，但直到最近才在大多数现代主流语言（C＃，C ++，Java，JavaScript，Perl，Python）中得到认可。
